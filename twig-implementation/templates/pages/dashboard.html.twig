{% extends "layout/base.html.twig" %}

{% block title %}Dashboard - TicketFlow{% endblock %}

{% block body %}
    {% include 'layout/header.html.twig' with {'isLoggedIn': true} %}

    <div class="dashboard-page">
        <div class="container">
            <div class="dashboard-header">
                <h1 class="dashboard-title">Dashboard</h1>
                <a href="/tickets.php" class="btn btn-primary">
                    Manage Tickets
                </a>
            </div>

            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="stat-label">Total Tickets</div>
                    <div class="stat-value" id="stat-total">0</div>
                </div>
                <div class="stat-card open">
                    <div class="stat-label">Open Tickets</div>
                    <div class="stat-value" id="stat-open">0</div>
                </div>
                <div class="stat-card in-progress">
                    <div class="stat-label">In Progress</div>
                    <div class="stat-value" id="stat-in-progress">0</div>
                </div>
                <div class="stat-card closed">
                    <div class="stat-label">Closed Tickets</div>
                    <div class="stat-value" id="stat-closed">0</div>
                </div>
            </div>

            <div class="dashboard-content">
                <h2 class="section-subtitle">Quick Overview</h2>
                <p style="color: #6b7280; margin-top: 1rem;">
                    Welcome to your dashboard! You have <span id="total-count">0</span> total tickets. 
                    Click "Manage Tickets" to view, create, edit, or delete tickets.
                </p>
            </div>
        </div>
    </div>

    {% include 'layout/footer.html.twig' %}
{% endblock %}

{% block extra_js %}
<script>
    // Check authentication
    if (!Auth.isAuthenticated()) {
        Toast.show('Your session has expired â€” please log in again.', 'error');
        setTimeout(() => {
            window.location.href = '/login.php';
        }, 1000);
    }

    // Load and display statistics
    function loadStats() {
        const tickets = Storage.getTickets();
        
        const stats = {
            total: tickets.length,
            open: tickets.filter(t => t.status === 'open').length,
            inProgress: tickets.filter(t => t.status === 'in_progress').length,
            closed: tickets.filter(t => t.status === 'closed').length
        };

        document.getElementById('stat-total').textContent = stats.total;
        document.getElementById('stat-open').textContent = stats.open;
        document.getElementById('stat-in-progress').textContent = stats.inProgress;
        document.getElementById('stat-closed').textContent = stats.closed;
        document.getElementById('total-count').textContent = stats.total;
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', loadStats);
</script>
{% endblock %}